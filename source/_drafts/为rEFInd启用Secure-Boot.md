---
title: 为rEFInd启用Secure Boot
tags:
  - 安全启动
  - rEFInd
post-index: true
categories: Dev
linkhash: '@@linkhash'
date: 2023-05-27 02:24:49
---

 > 不论如何，至少电脑没有变万元大砖头，可喜可贺！~~其实不太可能变砖。~~
 > 另：为了写这篇文章，特意用官方工具升级了一下rEFInd，结果成功把引导搞崩了，花了一个小时才救回来。这件事情告诉我们：当你想要折腾引导这种系统关键组件，一定要保证自己有足够的知识从错误中恢复！虽然现在的计算机往往有充足的防呆设计，不太可能因为用户的正常操作变黑砖，但是在操作前一定要谨慎。
 > 一个案例是：在根目录执行`sudo rm -rf / --no-preserve-root`可能导致一些设备变成**黑砖**，只能返厂上编程器救。怎么回事？不就是删除了硬盘上的文件，UEFI还在，怎么会变黑砖呢？原来，存储在NVRAM里的**EFI变量**是默认挂载在`/sys/firmware/efi/efivars`的，而且挂载为**可读写**，不然`efibootmgr`之类的工具怎么起作用呢？结果就是，不知不觉间，rm把这些性命攸关的EFI变量都抹除了。当你以为这行命令只不过是清空硬盘，整死操作系统的时候，它其实在美滋滋地擦写你的固件。如果这台电脑的UEFI实现得非常糟糕，没有考虑到这种奇特的状况，那么就等着傻眼吧！
 > 为什么这么重要的东西竟然会挂载为可读写呢？不过<span title="systemd">某linux重要基础设施</span>的维护人员似乎认为这无伤大雅。虽然大家一般不写EFI变量，但总有人是要写的。所谓：欲敲sudo，必承其重！
 > 可是，谁能想得到`rm -rf`竟会把固件整死了呢？

# 前因

人难免是爱折腾的。此前安装了第三方的引导**rEFInd**，换了比较好看的主题，总而言之摆脱了grub的大黑框（grub当然也可以设置主题，但那是另一回事了）。rEFInd的安装倒是没什么可说的，网上已经有很多人写过相关的博文了，不过大多数的教程都建议关闭**安全启动（Secure Boot）**，因为安全启动下加载第三方引导会非常麻烦。这倒也无伤大雅，总而言之我就把安全启动禁用了。

然而好景不长。有时电脑莫名地卡死，长按关机键重启，在电脑启动时会看到“**CMOS校验出现错误**”。所谓CMOS，就是是存储UEFI配置信息的地方。校验出错，说明配置可能已经损坏，于是接下来便恢复默认值了。安全启动默认开启，于是rEFInd无法加载，grub的大黑框又回来了。于是，我不得不进入UEFI配置，把安全启动关掉。

不过，这并称不上一种优雅的办法。实际上，有办法令rEFInd在安全启动下加载，而且相当简单，可惜国内的教程往往对此语焉不详，或者直接建议关掉安全启动。具体的做法，其实在rEFInd的官网上有[很详细的介绍](https://www.rodsbooks.com/refind/secureboot.html)可供参阅。这份文档不但说明了如何在启用安全启动的情况下安装rEFInd，而且很清晰地介绍了Secure Boot的概况。

# 关于安全启动

Secure Boot是微软牵头做的一个安全机制。


  